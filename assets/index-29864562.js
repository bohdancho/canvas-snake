var q=Object.defineProperty;var m=(r,t,e)=>t in r?q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>(m(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class y{constructor(t){o(this,"sizePx");o(this,"ctx");this.ctx=y.getContext(t);const{width:e,height:s}=t.getBoundingClientRect();t.width=e,t.height=s,this.sizePx=e}static getContext(t){const e=t.getContext("2d");if(!e)throw Error("No ctx");return e}}const u={field:{length:7},snake:{initLength:3,moveFrequencyMs:300},colors:{grid:"#6b7280",snake:"#3b82f6",food:"#ef4444"}};function f(r,t){return Math.floor(Math.random()*(t-r+1))+r}var h=(r=>(r.x_pos="x_pos",r.x_neg="x_neg",r.y_pos="y_pos",r.y_neg="y_neg",r))(h||{});function w(){const r=Object.values(h),t=f(0,r.length-1);return r[t]}function P(r,t){return r[0]!==t[0]}class l{constructor(t,e){this.x=t,this.y=e}static areEqual(t,e){return t.x===e.x&&t.y===e.y}static random(t){const e=f(0,t-1),s=f(0,t-1);return new l(e,s)}}const p={ArrowLeft:h.x_neg,ArrowRight:h.x_pos,ArrowUp:h.y_neg,ArrowDown:h.y_pos};class S{constructor(t){this.actions=t}listen(){document.addEventListener("keydown",({key:t})=>{b(t)&&this.actions.changeDirection(p[t])})}}function b(r){return Object.keys(p).includes(r)}class x{constructor(t,e,s){o(this,"color",u.colors.food);this.field=t,this.position=e,this.onEaten=s,this.field.updateSquare(e,this)}initRender(){this.field.renderSquare(this.position)}onDestroy(){this.onEaten()}}class L{constructor(t){o(this,"food");this.field=t}init(){this.generateFood()}generateFood(){this.food=new x(this.field,this.field.getRandomFreeLocation(),this.onEaten.bind(this)),this.food.initRender()}onEaten(){this.generateFood()}}class g{constructor(t){o(this,"length",u.field.length);o(this,"gridColor",u.colors.grid);o(this,"squares");o(this,"squareLengthPx");this.canvas=t;const e=g.getSquareLengthPx(t,this.length);this.squareLengthPx=e,this.squares=g.getInitialSquares(t,this.length,e,this.gridColor)}initRender(){this.squares.forEach(t=>t.forEach(e=>{e.render()})),this.paintInitBorder()}updateSquare(t,e){const s=this.getSquare(t);s.entity=e}renderSquare(t){this.getSquare(t).render()}getRandomFreeLocation(){const t=l.random(this.length);return this.getSquare(t).entity===null?t:this.getRandomFreeLocation()}getSquare(t){return this.squares[t.y][t.x]}isValidLocation(t){const{x:e,y:s}=t;return e>=0&&s>=0&&e<this.length&&s<this.length}paintInitBorder(){this.canvas.ctx.strokeStyle=this.gridColor,this.canvas.ctx.strokeRect(0,0,this.length*this.squareLengthPx,this.length*this.squareLengthPx)}static getConnectedSquare(t,e){let{x:s,y:i}=e;switch(t){case h.x_pos:s++;break;case h.x_neg:s--;break;case h.y_pos:i++;break;case h.y_neg:i--;break}return new l(s,i)}static getSquareLengthPx(t,e){return Math.floor(t.sizePx/e)}static getInitialSquares(t,e,s,i){const n=[];for(let a=0;a<e;a++){n[a]=[];for(let d=0;d<e;d++)n[a][d]=new C(t,s,new l(d,a),i)}return n}}class C{constructor(t,e,s,i){o(this,"_entity",null);this.canvas=t,this.lengthPx=e,this.position=s,this.borderColor=i}render(){this._entity?this.paint(this._entity.color):this.clear()}get entity(){return this._entity}set entity(t){var s,i;this._entity!==t&&((i=(s=this._entity)==null?void 0:s.onDestroy)==null||i.call(s)),this._entity=t}paint(t){this.canvas.ctx.fillStyle=t,this.canvas.ctx.fillRect(this.lengthPx*this.position.x,this.lengthPx*this.position.y,this.lengthPx,this.lengthPx)}clear(){this.canvas.ctx.clearRect(this.lengthPx*this.position.x,this.lengthPx*this.position.y,this.lengthPx,this.lengthPx),this.paintBorder()}paintBorder(){this.canvas.ctx.strokeStyle=this.borderColor,this.canvas.ctx.strokeRect(this.lengthPx*this.position.x,this.lengthPx*this.position.y,this.lengthPx,this.lengthPx)}}class c{constructor(t,e,s,i){o(this,"state");this.snake=t,this.field=e,this.state=c.getInitialState(this.field,i,s),this.state.forEach(n=>this.field.updateSquare(n,t))}grow(t){const e=c.getHead(this.state),s=g.getConnectedSquare(t,e),i=c.transpileLocation(s,this.field.length),n=this.field.getSquare(i).entity;if(n===this.snake)return{event:"collapsed"};const a=n instanceof x?"ateFood":null;return this.state.push(i),this.field.updateSquare(i,this.snake),this.field.renderSquare(i),{event:a}}trimTail(){const t=this.state.shift();if(!t)throw Error("Snake move error");this.field.updateSquare(t,null),this.field.renderSquare(t)}static transpileLocation(t,e){const s={x:t.x,y:t.y};return["x","y"].forEach(n=>{t[n]>=e&&(s[n]=0),t[n]<0&&(s[n]=e-1)}),new l(s.x,s.y)}static getInitialState(t,e,s){const n=[l.random(t.length)];for(let a=1;a<s;a++){const d=c.getHead(n);n.push(g.getConnectedSquare(e,d))}return t.isValidLocation(c.getHead(n))?n:c.getInitialState(t,e,s)}static getHead(t){const e=t.at(-1);if(!e)throw Error("No snake head");return e}}class M{constructor(t,e,s,i,n){o(this,"validDirection");o(this,"requestedDirection");o(this,"moveInterval");this.field=t,this.body=e,this.onCollapse=s,this.moveFrequencyMs=i,this.validDirection=n}get direction(){return this.validDirection}set direction(t){P(this.direction,t)&&(this.requestedDirection=t)}startMoving(){this.moveInterval=setInterval(()=>this.move(),this.moveFrequencyMs)}stopMoving(){clearInterval(this.moveInterval)}move(){this.requestedDirection&&(this.validDirection=this.requestedDirection,this.requestedDirection=void 0);const{event:t}=this.body.grow(this.validDirection);if(t==="collapsed"){this.stopMoving(),this.onCollapse();return}t!=="ateFood"&&this.body.trimTail()}}class k{constructor(t,e){o(this,"color",u.colors.snake);o(this,"body");o(this,"mover");this.field=t,this.onCollapse=e;const s=w();this.body=new c(this,this.field,u.snake.initLength,s),this.mover=new M(this.field,this.body,this.onCollapse,u.snake.moveFrequencyMs,s)}startMoving(){this.mover.startMoving()}get direction(){return this.mover.direction}set direction(t){this.mover.direction=t}}class E{constructor(t){o(this,"field");o(this,"snake");o(this,"keyboard");o(this,"foodManager");const e=new y(t),s=new g(e),i=new k(s,this.onLoss);this.field=s,this.snake=i,this.keyboard=new S({changeDirection:n=>this.snake.direction=n}),this.foodManager=new L(s)}start(){this.field.initRender(),this.snake.startMoving(),this.foodManager.init(),this.keyboard.listen()}onLoss(){alert("you lost")}}const v=document.querySelector("#canvas");if(!v)throw Error("No canvas");const I=new E(v);I.start();
