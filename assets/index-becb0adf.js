var w=Object.defineProperty;var L=(n,t,e)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(L(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();class m{constructor(t){r(this,"sizePx");r(this,"ctx");this.ctx=m.getContext(t);const{width:e,height:s}=t.getBoundingClientRect();t.width=e,t.height=s,this.sizePx=e}static getContext(t){const e=t.getContext("2d");if(!e)throw Error("No ctx");return e}}const g={field:{length:7},snake:{initLength:3,moveFrequencyMs:300},colors:{grid:"#6b7280",snake:"#3b82f6",food:"#ef4444"}};function y(n,t){return Math.floor(Math.random()*(t-n+1))+n}var c=(n=>(n.x_pos="x_pos",n.x_neg="x_neg",n.y_pos="y_pos",n.y_neg="y_neg",n))(c||{});function P(){const n=Object.values(c),t=y(0,n.length-1);return n[t]}function b(n,t){return n[0]!==t[0]}class l{constructor(t,e){this.x=t,this.y=e}static areEqual(t,e){return t.x===e.x&&t.y===e.y}static random(t){const e=y(0,t-1),s=y(0,t-1);return new l(e,s)}}const x={ArrowLeft:c.x_neg,ArrowRight:c.x_pos,ArrowUp:c.y_neg,ArrowDown:c.y_pos};class C{constructor(t){this.actions=t}listen(){document.addEventListener("keydown",({key:t})=>{M(t)&&this.actions.changeDirection(x[t])})}}function M(n){return Object.keys(x).includes(n)}class v{constructor(t,e,s){r(this,"color",g.colors.food);this.field=t,this.location=e,this.onEaten=s,this.field.updateSquare(e,this)}initRender(){this.field.renderSquare(this.location)}onDestroy(){this.onEaten()}}class k{constructor(t){r(this,"food");this.field=t}init(){this.generateFood()}generateFood(){this.food=new v(this.field,this.field.getRandomFreeLocation(),this.onEaten.bind(this)),this.food.initRender()}onEaten(){this.generateFood()}}class u{constructor(t){r(this,"length",g.field.length);r(this,"gridColor",g.colors.grid);r(this,"squares");r(this,"squareLengthPx");this.canvas=t;const e=u.getSquareLengthPx(this.canvas,this.length);this.squareLengthPx=e,this.squares=u.getInitialSquares(this.canvas,this.length,e,this.gridColor)}initRender(){this.squares.forEach(t=>t.forEach(e=>{e.render()})),this.paintInitBorder()}updateSquare(t,e){const s=this.getSquare(t);s.entity=e}renderSquare(t){this.getSquare(t).render()}getRandomFreeLocation(){const t=l.random(this.length);return this.getSquare(t).entity===null?t:this.getRandomFreeLocation()}getSquare(t){return this.squares[t.y][t.x]}isValidLocation(t){const{x:e,y:s}=t;return e>=0&&s>=0&&e<this.length&&s<this.length}paintInitBorder(){this.canvas.ctx.strokeStyle=this.gridColor,this.canvas.ctx.strokeRect(0,0,this.length*this.squareLengthPx,this.length*this.squareLengthPx)}static getConnectedLocation(t,e){let{x:s,y:i}=e;switch(t){case c.x_pos:s++;break;case c.x_neg:s--;break;case c.y_pos:i++;break;case c.y_neg:i--;break}return new l(s,i)}static getSquareLengthPx(t,e){return Math.floor(t.sizePx/e)}static getInitialSquares(t,e,s,i){const o=[];for(let a=0;a<e;a++){o[a]=[];for(let d=0;d<e;d++)o[a][d]=new E(t,s,new l(d,a),i)}return o}}class E{constructor(t,e,s,i){r(this,"_entity",null);this.canvas=t,this.lengthPx=e,this.location=s,this.borderColor=i}render(){this._entity?this.paint(this._entity.color):this.clear()}get entity(){return this._entity}set entity(t){var s,i;this._entity!==t&&((i=(s=this._entity)==null?void 0:s.onDestroy)==null||i.call(s)),this._entity=t}paint(t){this.canvas.ctx.fillStyle=t,this.canvas.ctx.fillRect(this.lengthPx*this.location.x,this.lengthPx*this.location.y,this.lengthPx,this.lengthPx)}clear(){this.canvas.ctx.clearRect(this.lengthPx*this.location.x,this.lengthPx*this.location.y,this.lengthPx,this.lengthPx),this.paintBorder()}paintBorder(){this.canvas.ctx.strokeStyle=this.borderColor,this.canvas.ctx.strokeRect(this.lengthPx*this.location.x,this.lengthPx*this.location.y,this.lengthPx,this.lengthPx)}}class f{constructor(t){r(this,"_location");this._location=t}get location(){return this._location}}class h{constructor(t,e,s,i){r(this,"segments");this.snake=t,this.field=e,this.segments=h.getInitialSegments(this.field,i,s),this.segments.forEach(o=>this.field.updateSquare(o.location,t))}growForward(t){const e=h.getLastSegment(this.segments),s=u.getConnectedLocation(t,e.location),i=h.transpileLocation(s,this.field.length),o=this.field.getSquare(i).entity;if(o===this.snake)return{event:"collapsed"};const a=o instanceof v?"ateFood":null;return this.segments.push(new f(i)),this.field.updateSquare(i,this.snake),this.field.renderSquare(i),{event:a}}trimTail(){const t=this.segments.shift();if(!t)throw Error("Snake trimTail failed");this.field.updateSquare(t.location,null),this.field.renderSquare(t.location)}static transpileLocation(t,e){const s={x:t.x,y:t.y};return["x","y"].forEach(o=>{t[o]>=e&&(s[o]=0),t[o]<0&&(s[o]=e-1)}),new l(s.x,s.y)}static getInitialSegments(t,e,s){const i=l.random(t.length),a=[new f(i)];for(;a.length<s;){const q=h.getLastSegment(a),S=u.getConnectedLocation(e,q.location);a.push(new f(S))}const d=h.getLastSegment(a);return t.isValidLocation(d.location)?a:h.getInitialSegments(t,e,s)}static getLastSegment(t){const e=t.at(-1);if(!e)throw Error("Snake without segments");return e}}class F{constructor(t,e,s,i,o){r(this,"validDirection");r(this,"requestedDirection");r(this,"moveInterval");this.field=t,this.body=e,this.onCollapse=s,this.moveFrequencyMs=i,this.validDirection=o}get direction(){return this.validDirection}set direction(t){b(this.direction,t)&&(this.requestedDirection=t)}startMoving(){this.moveInterval=setInterval(()=>this.move(),this.moveFrequencyMs)}stopMoving(){clearInterval(this.moveInterval)}move(){this.requestedDirection&&(this.validDirection=this.requestedDirection,this.requestedDirection=void 0);const{event:t}=this.body.growForward(this.validDirection);if(t==="collapsed"){this.stopMoving(),this.onCollapse();return}t!=="ateFood"&&this.body.trimTail()}}class _{constructor(t,e){r(this,"color",g.colors.snake);r(this,"body");r(this,"mover");this.field=t,this.onCollapse=e;const s=P();this.body=new h(this,this.field,g.snake.initLength,s),this.mover=new F(this.field,this.body,this.onCollapse,g.snake.moveFrequencyMs,s)}startMoving(){this.mover.startMoving()}get direction(){return this.mover.direction}set direction(t){this.mover.direction=t}}class I{constructor(t){r(this,"field");r(this,"snake");r(this,"keyboard");r(this,"foodManager");const e=new m(t);this.field=new u(e),this.snake=new _(this.field,this.onLoss),this.keyboard=new C({changeDirection:s=>this.snake.direction=s}),this.foodManager=new k(this.field)}start(){this.field.initRender(),this.snake.startMoving(),this.foodManager.init(),this.keyboard.listen()}onLoss(){alert("you lost")}}const p=document.querySelector("#canvas");if(!p)throw Error("No canvas");const D=new I(p);D.start();
